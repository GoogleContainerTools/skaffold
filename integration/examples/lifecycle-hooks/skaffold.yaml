apiVersion: skaffold/v3alpha1
kind: Config
build:
  artifacts:
  - image: hooks-example
    sync:
      manual:
      - src: hello.txt
        dest: .
      hooks:
        before:
        - host:
            command:
            - sh
            - -c
            - 'echo file changes detected: $SKAFFOLD_FILES_ADDED_OR_MODIFIED'
            os:
            - darwin
            - linux
        - host:
            command:
            - cmd.exe
            - /C
            - 'echo file changes detected: %SKAFFOLD_FILES_ADDED_OR_MODIFIED%'
            os:
            - windows
        after:
        - container:
            command:
            - sh
            - -c
            - set -x; kill -HUP 1
    hooks:
      before:
      - command:
        - sh
        - -c
        - ./hook.sh
        os:
        - darwin
        - linux
        dir: .
      - command:
        - cmd.exe
        - /C
        - hook.bat
        os:
        - windows
        dir: .
      after:
      - command:
        - sh
        - -c
        - docker images $SKAFFOLD_IMAGE --digests
        os:
        - darwin
        - linux
      - command:
        - cmd.exe
        - /C
        - docker images %SKAFFOLD_IMAGE% --digests
        os:
        - windows
manifests:
  rawYaml:
  - deployment.yaml
deploy:
  kubectl:
    hooks:
      before:
      - host:
          command:
          - sh
          - -c
          - echo pre-deploy host hook running on $(hostname)!
          os:
          - darwin
          - linux
      - container:
          command:
          - sh
          - -c
          - echo pre-deploy container hook running on $(hostname)!
          podName: hooks-example-deployment*
          containerName: hooks-example*
      after:
      - host:
          command:
          - sh
          - -c
          - echo post-deploy host hook running on $(hostname)!
      - container:
          command:
          - sh
          - -c
          - echo post-deploy container hook running on $(hostname)!
          podName: hooks-example-deployment*
          containerName: hooks-example*
