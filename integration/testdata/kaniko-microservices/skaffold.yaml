apiVersion: skaffold/v2beta27
kind: Config
build:
  artifacts:
    - image: leeroy-web
      context: ./leeroy-web/
      kaniko:
        cache: {}
        image: gcr.io/kaniko-project/executor:v1.6.0
      requires:
      - image: base
        alias: BASE
    - image: leeroy-app
      context: ./leeroy-app/
      kaniko:
        cache: {}
        image: gcr.io/kaniko-project/executor:v1.6.0
        target: target_stage
      requires:
      - image: base
        alias: BASE
    - image: base
      context: ./base/
      kaniko:
        cache: {}
        image: gcr.io/kaniko-project/executor:v1.6.0
  cluster:
    pullSecretName: e2esecret
deploy:
  kubectl:
    manifests:
      - ./leeroy-web/kubernetes/*
      - ./leeroy-app/kubernetes/*
